heat_template_version: 2021-04-16

description: A template to deploy all infrastructure needed for `airun`.

parameters:
  instance_exists:
    type: boolean
    label: Instance exists
    description: >
      Set to true to ensure the instance exists.
      Set to false to ensure the instance gets destroyed if it exists.
    default: false
  instance_name:
    type: string
    label: Instance name
    constraints:
    - allowed_pattern: "[a-zA-Z0-9-]+"
    default: "airun-instance"
  instance_flavor:
    type: string
    label: Instance flavor
    constraints:
    - allowed_pattern: "[a-zA-Z0-9-]+"
    default: "nvl4-a4-ram8-disk80-perf1"
  key_name:
    type: string
    label: Key name
    description: Name of the keypair to use for the instance
    default: "airun_key"

conditions:
  instance_exists:
    get_param: instance_exists

resources:
  airun_instance:
    type: OS::Nova::Server
    condition: instance_exists
    properties:
      name:
        get_param: instance_name
      key_name:
        get_param: key_name
      image: "Debian 13 trixie"
      flavor:
        get_param: instance_flavor
      networks:
        - network: "ext-net1"
